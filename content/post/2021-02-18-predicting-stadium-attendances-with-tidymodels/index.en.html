---
title: Predicting stadium attendances with tidymodels (WIP)
author: James
date: '2021-02-18'
slug: predicting-stadium-attendances-with-tidymodels
categories: []
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2021-02-18T22:07:35Z'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
draft: no
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this post I’m going to be trying out the new <a href="https://www.tidymodels.org/">tidymodels framework</a> in R.</p>
<p>I’ve been reading through the corresponding <a href="https://www.tmwr.org/">book</a> and it looks to me like a real game-changer for building robust statistical/ML models quickly in the R language. But I’ve had enough of reading! Time to test it out.</p>
<p>The data I’m going to be using is a <a href="https://github.com/rfordatascience/tidytuesday">#TidyTuesday dataset</a> from last year related to crowd attendances in the American national football league (NFL). <del>I’ll avoid making a little dig about how this isn’t proper football in the British sense of the word because that would be churlish.</del> Credit to Julia Silge, whose code I’ve adapted and extended here.</p>
</div>
<div id="load-and-inspect-the-data" class="section level2">
<h2>Load and inspect the data</h2>
<pre class="r"><code>attendance &lt;- read_csv(&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-04/attendance.csv&quot;)
results &lt;- read_csv(&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-04/standings.csv&quot;)</code></pre>
<p>Our first dataset is about attendance per team every week since the year 2000:</p>
<pre class="r"><code>head(attendance)</code></pre>
<pre><code>## # A tibble: 6 x 8
##   team    team_name  year  total   home   away  week weekly_attendance
##   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;
## 1 Arizona Cardinals  2000 893926 387475 506451     1             77434
## 2 Arizona Cardinals  2000 893926 387475 506451     2             66009
## 3 Arizona Cardinals  2000 893926 387475 506451     3                NA
## 4 Arizona Cardinals  2000 893926 387475 506451     4             71801
## 5 Arizona Cardinals  2000 893926 387475 506451     5             66985
## 6 Arizona Cardinals  2000 893926 387475 506451     6             44296</code></pre>
<p>And our second dataset gives us results stats for each team about things like final standings, wins/losses, points for/against and whether the team made the playoffs for every year since 2000.</p>
<pre class="r"><code>glimpse(results) # glimpse() rather than head() as there are many columns</code></pre>
<pre><code>## Rows: 638
## Columns: 15
## $ team                 &lt;chr&gt; &quot;Miami&quot;, &quot;Indianapolis&quot;, &quot;New York&quot;, &quot;Buffalo&quot;, …
## $ team_name            &lt;chr&gt; &quot;Dolphins&quot;, &quot;Colts&quot;, &quot;Jets&quot;, &quot;Bills&quot;, &quot;Patriots&quot;…
## $ year                 &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, …
## $ wins                 &lt;dbl&gt; 11, 10, 9, 8, 5, 13, 12, 9, 7, 4, 3, 12, 11, 7, …
## $ loss                 &lt;dbl&gt; 5, 6, 7, 8, 11, 3, 4, 7, 9, 12, 13, 4, 5, 9, 10,…
## $ points_for           &lt;dbl&gt; 323, 429, 321, 315, 276, 346, 333, 321, 367, 185…
## $ points_against       &lt;dbl&gt; 226, 326, 321, 350, 338, 191, 165, 255, 327, 359…
## $ points_differential  &lt;dbl&gt; 97, 103, 0, -35, -62, 155, 168, 66, 40, -174, -2…
## $ margin_of_victory    &lt;dbl&gt; 6.1, 6.4, 0.0, -2.2, -3.9, 9.7, 10.5, 4.1, 2.5, …
## $ strength_of_schedule &lt;dbl&gt; 1.0, 1.5, 3.5, 2.2, 1.4, -1.3, -2.5, -0.2, -1.4,…
## $ simple_rating        &lt;dbl&gt; 7.1, 7.9, 3.5, 0.0, -2.5, 8.3, 8.0, 3.9, 1.1, -1…
## $ offensive_ranking    &lt;dbl&gt; 0.0, 7.1, 1.4, 0.5, -2.7, 1.5, 0.0, 0.6, 3.2, -8…
## $ defensive_ranking    &lt;dbl&gt; 7.1, 0.8, 2.2, -0.5, 0.2, 6.8, 8.0, 3.3, -2.1, -…
## $ playoffs             &lt;chr&gt; &quot;Playoffs&quot;, &quot;Playoffs&quot;, &quot;No Playoffs&quot;, &quot;No Playo…
## $ sb_winner            &lt;chr&gt; &quot;No Superbowl&quot;, &quot;No Superbowl&quot;, &quot;No Superbowl&quot;, …</code></pre>
<p>Let’s join these datasets by team and year to get one large dataset combining data on results and attendances which we can use for modelling.</p>
<pre class="r"><code>attendance_joined &lt;- attendance %&gt;%
  left_join(results,
    by = c(&quot;year&quot;, &quot;team_name&quot;, &quot;team&quot;)
  )

glimpse(attendance_joined)</code></pre>
<pre><code>## Rows: 10,846
## Columns: 20
## $ team                 &lt;chr&gt; &quot;Arizona&quot;, &quot;Arizona&quot;, &quot;Arizona&quot;, &quot;Arizona&quot;, &quot;Ari…
## $ team_name            &lt;chr&gt; &quot;Cardinals&quot;, &quot;Cardinals&quot;, &quot;Cardinals&quot;, &quot;Cardinal…
## $ year                 &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, …
## $ total                &lt;dbl&gt; 893926, 893926, 893926, 893926, 893926, 893926, …
## $ home                 &lt;dbl&gt; 387475, 387475, 387475, 387475, 387475, 387475, …
## $ away                 &lt;dbl&gt; 506451, 506451, 506451, 506451, 506451, 506451, …
## $ week                 &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1…
## $ weekly_attendance    &lt;dbl&gt; 77434, 66009, NA, 71801, 66985, 44296, 38293, 62…
## $ wins                 &lt;dbl&gt; 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, …
## $ loss                 &lt;dbl&gt; 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, …
## $ points_for           &lt;dbl&gt; 210, 210, 210, 210, 210, 210, 210, 210, 210, 210…
## $ points_against       &lt;dbl&gt; 443, 443, 443, 443, 443, 443, 443, 443, 443, 443…
## $ points_differential  &lt;dbl&gt; -233, -233, -233, -233, -233, -233, -233, -233, …
## $ margin_of_victory    &lt;dbl&gt; -14.6, -14.6, -14.6, -14.6, -14.6, -14.6, -14.6,…
## $ strength_of_schedule &lt;dbl&gt; -0.7, -0.7, -0.7, -0.7, -0.7, -0.7, -0.7, -0.7, …
## $ simple_rating        &lt;dbl&gt; -15.2, -15.2, -15.2, -15.2, -15.2, -15.2, -15.2,…
## $ offensive_ranking    &lt;dbl&gt; -7.2, -7.2, -7.2, -7.2, -7.2, -7.2, -7.2, -7.2, …
## $ defensive_ranking    &lt;dbl&gt; -8.1, -8.1, -8.1, -8.1, -8.1, -8.1, -8.1, -8.1, …
## $ playoffs             &lt;chr&gt; &quot;No Playoffs&quot;, &quot;No Playoffs&quot;, &quot;No Playoffs&quot;, &quot;No…
## $ sb_winner            &lt;chr&gt; &quot;No Superbowl&quot;, &quot;No Superbowl&quot;, &quot;No Superbowl&quot;, …</code></pre>
</div>
<div id="data-exploration" class="section level2">
<h2>Data exploration</h2>
</div>
